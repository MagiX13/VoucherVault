{% extends "base.html" %}

{% block content %}
<div class="pagetitle">
  <h1>Item Details</h1>
  <nav>
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="{% url 'dashboard' %}">Home</a></li>
      <li class="breadcrumb-item"><a href="{% url 'show_items' %}">Inventory</a></li>
      <li class="breadcrumb-item active">Item Details</li>
    </ol>
  </nav>
</div><!-- End Page Title -->

<section class="section dashboard">
  <div class="row">

    <!-- Full width column -->
    <div class="col-lg-12">
      <div class="row">

        <!-- Item Details Card -->
        <div class="col-lg-8">
          <div class="card info-card sales-card">
            <div class="card-body">
              <h5 class="card-title">
                <i class="bi bi-shop"></i> {{ item.issuer }} 
                <span>| {{ item.type }}
                        {% if item.is_used %}
                          - <span style="color:red">used</span>
                        {% elif item.expiry_date|date:"Y-m-d" < current_date|date:"Y-m-d" %}
                          - <span style="color:red">expired</span>
                        {% else %}
                          - <span style="color:green">available</span>
                        {% endif %}
                      </span>
              </h5>
              <h6>{{ item.name }}</h6>
              <table style="width: 100%;">
                <tr>
                  <td style="vertical-align: top;">
                    <div class="ps-3">
                      <span class="text-muted small pt-2 ps-1"><i class="bi bi-key"></i> <b>Redeem Code</b>: {{ item.redeem_code }}</span><br>
                      <span class="text-muted small pt-2 ps-1"><i class="bi bi-calendar"></i> <b>Issue Date</b>: {{ item.issue_date }}</span><br>
                      <span class="text-muted small pt-2 ps-1"><i class="bi bi-calendar-x"></i> <b>Expiry Date</b>: {{ item.expiry_date }}</span><br>
                      <span class="text-muted small pt-2 ps-1"><i class="bi bi-cash"></i> <b>Value</b>: {{ item.value }}</span><br><br>
                      <span class="text-muted small pt-2 ps-0"><b>Description</b>:<br><span class="text-muted small pt-2 ps-0">{{ item.description }}</span></span><br><br>
                    </div>
                  </td>
                </tr>
              </table>
              <div class="d-flex justify-content-end">
                <a href="{% url 'edit_item' item.id %}" class="btn btn-primary me-2"><i class="bi bi-pencil"></i> Edit</a>
                <form action="{% url 'delete_item' item.id %}" method="post" class="me-2">
                  {% csrf_token %}
                  <button type="submit" class="btn btn-danger" onclick="return confirm('Are you sure you want to delete this item?');"><i class="bi bi-trash"></i> Delete</button>
                </form>
                <form action="{% url 'toggle_item_status' item.id %}" method="post">
                  {% csrf_token %}
                  <button type="submit" class="btn {% if item.is_used %} btn-success {% else %} btn-warning {% endif %}">
                    <i class="bi bi-check-circle"></i>
                    {% if item.is_used %} Mark as Available {% else %} Mark as Used {% endif %}
                  </button>
                </form>
              </div>
            </div>
          </div>
        </div><!-- End Item Details Card -->

        <!-- QR Code and Barcode Card -->
        <div class="col-lg-4">
          <div class="card">
            <div class="card-body text-center">
              <h5 class="card-title">Scan to Redeem</h5>
              <img src="data:image/png;base64,{{ qr_code_base64 }}" alt="QR Code" class="img-fluid" style="max-width: 100%;">
              <img src="data:image/png;base64,{{ barcode_base64 }}" alt="Barcode" class="img-fluid" style="max-width: 100%;">
            </div>
          </div>
        </div><!-- End QR Code and Barcode Card -->

      </div>
    </div><!-- End Full width column -->

  </div>
</section>

<style>
  .description {
    max-height: 80px;
    overflow: hidden;
    text-overflow: ellipsis;
    display: -webkit-box;
    -webkit-line-clamp: 3; /* number of lines to show */
    -webkit-box-orient: vertical;
  }

  .card-title i {
    margin-right: 5px;
  }
</style>
{% endblock content %}
